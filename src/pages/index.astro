---
import PublicLayout from "@/layouts/PublicLayout.astro";
import { getDb } from "@/db";
import { posts } from "@/db/schema";
import { desc, eq } from "drizzle-orm";
import { format } from "date-fns";
import { Card, CardHeader, CardTitle, CardDescription, CardContent } from "@/components/ui/card";

// export const prerender = true;

const db = getDb(Astro.locals.runtime.env.DB);
const publishedPosts = await db.select().from(posts).where(eq(posts.status, 'published')).orderBy(desc(posts.publishedAt)).all();
---

<PublicLayout title="首页">
  <section class="space-y-6 pb-8 pt-6 md:pb-12 md:pt-10 lg:py-32">
    <div class="container flex max-w-[64rem] flex-col items-center gap-4 text-center">
      <h1 class="font-heading text-3xl sm:text-5xl md:text-6xl lg:text-7xl">
        杨振博客
      </h1>
      <p class="max-w-[42rem] leading-normal text-muted-foreground sm:text-xl sm:leading-8">
        想法，故事和观点。
      </p>
    </div>
  </section>
  
  <section class="container max-w-4xl py-6 lg:py-10">
    <div class="flex flex-col gap-8">
      {publishedPosts.map((post) => (
        <article class="flex flex-col gap-2 border-b pb-8 last:border-0">
          <h2 class="text-2xl font-bold leading-tight">
            <a href={`/posts/${post.slug}`} class="hover:underline">
              {post.title}
            </a>
          </h2>
          <div class="text-sm text-muted-foreground">
            {post.publishedAt ? format(post.publishedAt, "yyyy年MM月dd日") : ""}
          </div>
          <p class="text-muted-foreground">
            {post.excerpt || "暂无摘要"}
          </p>
          <a href={`/posts/${post.slug}`} class="text-sm font-medium hover:underline text-primary">
            阅读全文 &rarr;
          </a>
        </article>
      ))}
      {publishedPosts.length === 0 && (
        <p class="text-muted-foreground">暂无文章。</p>
      )}
    </div>
  </section>
</PublicLayout>
